# The Laserwood webstore site
This is the webpage I created for the fifth milestone project(Fullstack frameworks with django)at code institute, diploma in Software Development. This is a webshop page called Laserwood. This is a erbshop where you can buy wood products and get your names engraved in them. You can visit the website here:https://laserwood.herokuapp.com/
The website has a landing page, a page where you can browse products, Add your wished products in a shopping bag. A customer can edit or delete products in the shopping bag. By using stripe to set up payment method, the customer can "pay" securly with a test creditcard. The customer receives a confirmation email and can view personal information and order history. The page has also a small blog page where customers can read news about the webstore. Customers can also subscribe for more news. The webstore has a CRUD(create, read, update and delete) functionality and focus on the customer.

![image](https://res.cloudinary.com/dokp7kv2b/image/upload/v1665531725/responsive_oom1up.png)



## B2C e-commerce business model
### Value Propositions
Our customers are people that wants a highly quality products and can customize them with engraved names. Our customers are people that see the value of having names on their everyday products. People that buys the product are often parents, families or friends that see the practical in having names on barbecue sticks, hammers, knives etc. It is also perfect for a unique present, so the customer age can be all from 16 - 100 years old. The customer group is very broad.

### Market opportunity
The market space is big for this webshop. Our main customers are people that use social media daily, therefore we have chosen to use facebook, youtube and instagram. A facebook "businesspage" has been made to make people curious around our webstore and make people check out the webshop. Making blogpost on our facebook page/blog in our webstore/newsletters with marketing content is a nice way to find customers. Youtube videos and updating instagram with images from our store is also a nice way to show marketing content. Since this webshop is a small scale webstore business with few products and only 1 person working there. We must be careful not to grow to fast. Therefor the webstore will wait a bit with paid advertising/ influencer marketing or paying commissions to external websites. The website has done search engine optimizations.
We will promote our products through facebook, instagram, webstore blog, newsletters. We will also do advertise our products as a nice gift for familymembers or friends. Our products do sometimes offer discounts. Our user will surely be glad to hear about descounts. The goal of this webstore is to grow steadily, grow our business and offer new products to our customers. The best marketing strategies would be to start with advertising trough social media. This small scale business have a small budget on marketing.

![image](https://res.cloudinary.com/dokp7kv2b/image/upload/v1665532946/facebook_laserwood_ed9ldm.png)


## Ui and Ux
## Research
I have worked as a school teacher and in an elderly home and having names on peoples things are practical, a timesaver and a necessity. 



## Owner's goal
* The owner wants the ability to control how many items people are buying
* The owner wants the ability to read shopping orders, so he can know what names to engrave on the products
* The owner wants the ability to build the brand: 'Laserwood'
* The owner wants the ability to grow the webstore business.
* The owner wants the ability to read customers recommendations.
* The owner wants the ability to add new products
* The owner wants to sell many products.
* The owner wants the ability to add new blogposts.
* The owner wants the ability to delete products.
* The owner wants the ability to delete blog posts.




## User's goals
* The users would like to know how to contact Laserwood.
* The users would like to read about the products.
* The users would like to buy products.
* The users would like to edit or delete products in shopping bag.
* The users wants an userfriendly webstore.
* The users wants security when using creditcard to pay.
* The users would like to read about laserwood news/blog.
* The users would like to see their profile information and order history
* The users would like to register an account.
* The users would like to choose if they will buy anonymous or not.
* The users would like to log in and log out of that account.
* The users would like to receive an order confirmation.
* The users would like to subscribe to a newsletter.


## User stories
The users in this webpage is the owner and the customers. There can be many more userstories, but I choose these as my primary goals and aims for Laserwood webstore.
Admin: 
Laserwood webstore owner:
* As an admin I can add products so that I can add more products in the shop
* As an admin I can delete product in my shop so that I can delete products if I don`t have them anymore
* As an Admin I can add or delete blog posts so that I can update my blog

Account for users:
* As a User I can register an account so that I can have my own account and can view it
* As a User I can be able to login or logout so that I can access my account
* As a User I can recover my password so that in case I forget it I can get help accessing my account

webstore user or customer:
* As a User I can get an order confirmation after a purchase so that I know what items I have bought
* As a User I can use my credit card when buying ** so that ** I can use credit card as payment method and know that my credit card information will be secured
* As a user I can easily add my payment information so that I can purchase the products I want
* As a User I can buy products and get order confirmation so that I know I have paid my items
* As a user I can add my email so I can get a newsletter from the shop so that I can get news about this webshop
* As a user I can read the webshop`s blog so that I can learn more about this shop
* As a user I can understand that this is a webshop so that I can decide if I want to be a customer or not
* As a user I can click on a product so that I can read more about this product
* As a user I can *see what kind of products this shop is selling so that I can consider to buy products
* As a user I can add names on the wood products so that I get a product with my name on it or another name
* As a user I can view my bag so that I know what I have added to my shoppingbag
* As a user I can delete my items in the shopping bag so that So I can choose if I want to buy items or not
* As a user I can edit my shopping bag so that I can change my shopping bag
* As a user I can add many products in my bag so that I can buy as many as I want
* As a Useer I can search for products or words so that I can see what kind of information or read about their products
* As a user I can view my order information and my person information so that I have more control over my order history and my personal informatio
* As a User I can get a confirmation email so that I know my registration was successful


### Kanban planner
I used agile method to manage my milestone project. I used kanban planner to manage my userstories.


### Strategy plane
My userstories are highly focused on the customer. Below is a list (1-5), where one is least important and 5  is the most important userstory.
##### 5
* As an admin I can add products so that I can add more products in the shop
* As an admin I can delete product in my shop so that I can delete products if I don`t have them anymore
* As an Admin I can add or delete blog posts so that I can update my blog

* As a User I can use my credit card when buying ** so that ** I can use credit card as payment method and know that my credit card information will be secured
* As a user I can easily add my payment information so that I can purchase the products I want
* As a User I can buy products and get order confirmation so that I know I have paid my items  or not.
* As a user I can *see what kind of products this shop is selling so that I can consider to buy products
* As a user I can add names on the wood products so that I get a product with my name on it or another name
* As a user I can view my bag so that I know what I have added to my shoppingbag
* As a user I can delete my items in the shopping bag so that So I can choose if I want to buy items or not
* As a user I can edit my shopping bag so that I can change my shopping bag
* As a user I can add many products in my bag so that I can buy as many as I want

##### 4
* As a user I can add my email so I can get a newsletter from the shop so that I can get news about this webshop
* As a user I can read the webshop`s blog so that I can learn more about this shop
* As a user I can understand that this is a webshop so that I can decide if I want to be a customer or not
* As a user I can click on a product so that I can read more about this product
* As a User I can register an account so that I can have my own account and can view it
* As a User I can be able to login or logout so that I can access my account
* As a User I can recover my password so that in case I forget it I can get help accessing my account



### Future Features
(1-5), where one is least important and 5  is the most important userstory.
##### 5
* As an admin I can add products 'easily', so that I can add more products in the shop
* More detailed advertising, more images and information about each product
* As a user I can review products.
* As a user I can use a contact form if I need to contact Laserwood.
* Payment options like paypal

##### 4
* As a user I comment on the blogposts in the webstore
* Customers can delete their profiles.



### Scope plane
The userstories needs different pages to fulfill the userstories goals.
* Landing page(home page) where the users can see and understand with a blink on an eye, that this is a webstore. An easy landing page where users can easily understand and navigate in. They can also read details about the products.
* Registration page where the user can make an account.
* Login page where the users can log in. The owner can also login.
* Only the owner can log in and manage blog, products and orders.
* Sign out page where the users can sign out.
* Customers must be able to add products in their shopping bag with or without an useraccount.
* Customers must easily be able to add products in a shopping bag, choose how many and engraved names.
* Customers must be able to update shopping bag or delete the shopping bag
* Customers must be able to use a securily way to pay for their products.
* Customers must be able to see their profile information, be able to update that information and be able to see order history.


### Structure plane

* Landing page(index.html)
Home page of the website. There is a navbar, Laserwood image,'card' with welcome information and a browse product button located on the card. The header and footer is on every page in the website. there is also a subscribe card for a newsletter on every page in the website.
* Items page(items.html)
Almost identical to the home page. Three bootstrap cards, one card for each product. This webstore sell three products.
* Item detail page (items_detail.html)
Almost identical to the items.html. One big bootstrap card with detailed information about the product. The user can choose how many items they want to add in the shopping bag and can choose a name that they want to be engraved on the item or items.
* An edit or delete page(bag.html). The user can update their shopping bag or choose to delete it.
* Checkout page (checkout.html)
The user can buy their added products in shopping bag. The user must add  delivery information, name, email and credit card information.
* checkout success(checkout_success.html)
When a user have successfully bought their products, they will see this page. This page will show the order and profile information. An orderconfirmation will also be sent.
* If a user register an account, they will be able to go to profile.html. The user can see the profile information, order history and be able to update profile information
* Admin (/admin)
This Admin page is made by django. The admin/owner can add new products and blogs posts. The owner can also read orders or delete orders.
* Base template (base.html)
This base template is used to make a html that can be used as a base for every html template.
* Css and Javascript(.css and .js)
css and javascript are connected to the html files/templates.
* Registrtion(signup.html)
The users can register and create an account, this is done by Django Allauth.


Below you can see a flow chart of the webpage and see how the templates are connected.
![image](https://res.cloudinary.com/dokp7kv2b/image/upload/v1665537650/Flowchart_odcz5t.png)


In the flowchart you can see that a user can register an account, browse the webstore, browse product and buy products. An anonymous user can also browse the webstore, browse products and buy products. If a user tries to add a name with over 20 letters long, an error message will occur. The same with the amount of items. A customer can`t add 0 items in their shopping bag.


## Skeleton plane 
![image](https://res.cloudinary.com/dokp7kv2b/image/upload/v1665538027/userprofile-2_gezy6k.png)

![image](https://res.cloudinary.com/dokp7kv2b/image/upload/v1665538027/blog_uktnpp.png)

![image](https://res.cloudinary.com/dokp7kv2b/image/upload/v1665538026/updatedelete_wln7ha.png)

![image](https://res.cloudinary.com/dokp7kv2b/image/upload/v1665538026/items_if7lzq.png)

![image](https://res.cloudinary.com/dokp7kv2b/image/upload/v1665538026/userprofile_vlah0t.png)

![image](https://res.cloudinary.com/dokp7kv2b/image/upload/v1665538026/items_Detail_nqxvnj.png)

![image](https://res.cloudinary.com/dokp7kv2b/image/upload/v1665538026/checkout_jnr3lm.png)

![image](https://res.cloudinary.com/dokp7kv2b/image/upload/v1665538026/landing_page_bnk6yk.png)




<br>

## Backend
Customers can choose to register an account or buy products as a guest withour an account. Guest customers can not save their personal information. Only registered customers can save their personal information. Registered customers can see their profile information and their order history, guest customers cannot but everyone receives an order confirmation. If a guest customer choose to register in a later time, they will see their past order history. Each item belongs to a category, these are identified with an id/pk. Every order has an unique order number. This order number is generated when the customer buys products. In the orders, you can see item details and customer details. SQLite is a Django built-in database, that are used in the development mode. In Heroku, in production mode, postgres is used. All the static files images in production mode, is used by cloudinary.
Here is a chart of the database and their relationships.

![image](https://res.cloudinary.com/dokp7kv2b/image/upload/v1665540158/chartdatabase_w6rvw0.png)

## Surface Plane
I choosed natural calm colours as base colors for the website. This would match the wood products. To the nav bar and buttons I choosed different colors that would stand out a little and match the natural cal colours
The Delete button has a red strong color and the edit button has a blue bright button.
In the checkout success page and in the profile.html The order or order history has a bootstrap green 'success colour'
I used https://coolors.co/ to find ideas to how my colors would look nice on a website.



### Font
I used the font Lato that looks unique and interesting.

### Icons
I used fontawesome to make icons.


## Features
### Logo
The title has a little shading effect to make it stand out a little. The logo Laserwood is also large.


### Bootstrap Cards
The bootstrap cards matches the website colours and share mostly the same style


### Webstore background image

The background image is large image of people making a bonfire. The colours matches the webstore and theme.

 ### Footer
 A small footer at the end with a youtube link, instagram link and privacy policy attached to it.

### Navigation bar
The Navigation bar has colors that stands out a little from the calmer base colors that the webstore site has.

## Technology
I used different technologies to make this webpage:

* Coolors
* Balsamiq
* Fontawesome
* Flow chart
* Gitpod
* GitHub
* Heroku
* SQLite
* PostgreSQL
* Git
* Bootstrap 5
* Google Fonts
* Django
* Am I responsive
* VS-code
* Python3
* Git Hub
* cloudinary
* Chrome Dev Tool
* Css Validator
* Html Validator
* Javascript
* Mailchimp
* privacypolicygenerator
* Unsplash

## Languages

* HTML5
* CSS
## Manuel Testing 
Because of lack of time, I choosed to manually test my website.
### Landing page
* I click on shopping bag icon, to check if I am navigated to shopping bag page.
* I click on nav button home, to check I am navigated to home.
* I check that the hoover effect occur, on the home nav button
* I click on the next nav button blog, to check I am navigated to the blog page.
* I check that the hoover effect occur, on the blog nav button
* I click on the next nav button items to check that I am navigated to the items page.
* I check that the hoover effect occur on the items nav button
* I click on the next nav button My account to check that I am navigated to the account register page.
* I check that the hoover effect occur on the my account nav button
* I click on the youtube button to check that I am navigated to youtube index page.
* I click on the instagram button to check that I am navigated to instagram index page.
* I click on the privacy policy link, to check that I am navigated to the privacy policy document page.
* I click on the browse products button to see if I am navigated to items page.
* I check that the hoover effect occur on the browse products button
* I check if I can search after words in the searchbar. I write a product name and the product appears.
* I check if I can search after words in the searchbar. I write a non related name or word from a product. Nothing appears.
* I check if I can subscribe. I enter an email and click subscribe. This worked.
* I check if I can subscribe. I enter a non email and click sunscribe. It did not work.
 
### Items page
* I click on knife camper card 'read more' button. I am navigated to knife item_detail page
* I click on Hammer card 'read more' button. I am navigated to hammer item_detail page
* I click on Barbeque skewers card 'read more' button. I am navigated to the Barbeque skewers item_detail page.
* I click on nav button home, to check I am navigated to home.
* I check that the hoover effect occur, on the home nav button
* I click on the next nav button blog, to check I am navigated to the blog page.
* I check that the hoover effect occur, on the blog nav button
* I click on the next nav button items to check that I am navigated to the items page.
* I check that the hoover effect occur on the items nav button
* I click on the next nav button My account to check that I am navigated to the account register page.
* I check that the hoover effect occur on the my account nav button
* I click on the youtube button to check that I am navigated to youtube index page.
* I click on the instagram button to check that I am navigated to instagram index page.
* I click on the privacy policy link, to check that I am navigated to the privacy policy document page.
* I check that the hoover effect occur on the browse products button
* I check if I can search after words in the searchbar. I write a product name and the product appears.
* I check if I can search after words in the searchbar. I write a non related name or word from a product. Nothing appears.
* I check if I can subscribe. I enter an email and click subscribe. This worked.
* I check if I can subscribe. I enter a non email and click sunscribe. It did not work.
* I click on shopping bag icon, to check if I am navigated to shopping bag page.

### item detail page
* I check if I can add a number in amount and a name in name, I can.
* I check if I can add a number in amount and a name in name, and click on add item to bag btn. Now item is added in bag.
* I check if I can add a name longer then 20 letters in my bag, I can not.
* I check if I can add a name longer less then 20 letters in my bag, I can.
* I check if I can add many item amount in bag, I can.
* I check if the sum is correct with how many items I have in the bag and the price.
* I check if the discount price is correct when adding this item in the bag.
* I click on keep shopping btn, and I am navigated to items page.
### bag page
* I try to go to shopping bag page without adding products. I can go to shopping bag, but it`s empty.
* I add item, name and a spesific item in bag. I can now see these items in my bag.
* I try to change the name and I click update item, Now my shopping bag item is updated.
* I try to change the amount of items and click the update btn. Now my shopping bag item is updated.
* I click on the delete button in my shopping bag, an alert pops up. I try cancel button in the alert. It did not delete.
* I click on the delete button in my shopping bag, an alert pops up. I choose delete button in the alert. The item is deleted.
 from shopping bag.
* I add items in shopping bag, and delete some of the products. I see that the total sum is correct.
* I click on the keep shopping button. I am navigated to items page.
* I click on the secure checkout button, I am navigated to checkout page.
### checkout page
* I add my full name, email and delivery information in the fields in the form. I add the credit card test number,
My payment is successfull, I am navigated to checkout success page.
* I comment out the strpe_elements.js form submit code, to check if the webhook handler can complete my order.
I add my information again in the form with test credit card number. The spinner is just spinning in the page. In the stripe events, I can see an error occur.
* In the checkout form I try to complete the order without adding information, I can not.
* In the checkout form I try to add a non email information in the email field, I can not add a non email type.
* I click on the adjust bag button, I am navigated to shopping bag page.
* I click on keep shopping button. I am navigated to items page.
* As a registered user, I see that I can click on save info box. It works.
* As an unregistered user, I can not see save info box in the checkout page.
* As a customer guest without an account, I try to buy products, I can.

### checkout success page
* I check if my order information matches with the item or items that I choosed.
* I click on order link, and I am navigated to the order information.
* I check if I as a customer receives order confirmation, I do.
* I click on the keep shopping button, I am navigated to items page.


### profile page
* I check if my profile information matches with my payment information, it does, but their wrapt in parantheses.
* I check if I can update my profile information, by changing the information in the fields and click on update button.
It works.
* I check if my order history is correct.
* As an unregistered user, I try to write in the address bar profile.html. I am requested to be logged in.

### Blog page
* I check if I can click on blog button in my navigation, I am navigated to blog page.
* I can read the blog post

### Account pages
* I check if I can login as a registered user, I can.
* I check if I can logout as a registered user, I can.
* I check if I can register as a new user, I can.
* I check if I can login without being a registered user, I can not.
* I check if I can go to profile page withour being a registred user, I can not.

### Error page 400
* I check in the deployed site, I write in the address bar an unknown word. I am navigated to 400.html

### Admin page
* I check as a superuser, that I can read, add and delete orders in admin, I can
* I check as a superuser, that I can read, add and delete blog post in admin, I can.
* I check as a superuser, that I can read, add and delete items in admin, I can.
* I check if only admin can login to admin page.


### Validator Testing 
**HTML**

* The offical W3C validator showed no errors when tested.

**CSS**

* The official Jigsaw validator showed no errors when tested.
**PEP8**
In the settings.py , the AUTH_PASSWORD_VALIDATORS showed to long lines,
but I left them like that because it came like that.

I had multiple pylint(no-member) issues, but I choose to leave them because
I couldn`t see how to fix these by the short time I had left.



**Accessibility**
* By using lighthouse in devtools I could see that the webpage scored well on the tests.


#### code
I had to use global variables in this project. I know that it is not advices. 
But it was the only way to be able to not overwrite the bag, if the bag contained the same engraved name or id.

### Commit messages

* Some of my commit messages could been written in a much better way.
* I should commited more often

### Unfixed Bugs
* In the profile page. After adding delivery information and user information in the checkoutform. I can see that the profile
information in the profile page is wrapped in parantheses. The user needs to remove the parantheses.

## Deployment
It can be wise to deploy to heroku in the very beginning of your project. I will write a step by step from installing django till deployment. Remember to hide your secret codes in an env.py
In terminal, write heroku login -i
log in to your heroku account in the terminal.
then write:
heroku apps: create myapp(your app name) -- region eu
Now go to your heroku webpage, click on resources.
Now add postgres
In the terminal write and install:
* pip3 install dj_database_url
* pip3 install psycopg2-binary
* pip3 install django-allauth --upgrade
then write:
* pip3 freeze > requirements.txt
* Go to Heroku webpage setting tab and find Config Vars, Click on the "Reveal config Vars" and copy the
 postgres database url. Add this in your env.py file.
In your settings.py add these lines instead of the default information
about database.

if 'DATABASE_URL' in os.environ:
    DATABASES = {
        'default': dj_database_url.parse(os.environ.get('DATABASE_URL'))
    }
else:
    DATABASES = {
        'default': {
            'ENGINE': 'django.db.backends.sqlite3',
            'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
        }
    }
DATABASES = {
    'default': dj_database_url.parse(os.environ.get('DATABASE_URL'))
}

In your terminal, write:
*  python3 manage.py showmigrations
*  python3 manage.py migrate

I used fixtures when adding items and categories.
First it must be imported. It is important that
category is loaded first and then items second.
The items depends on the existings of the category

In terminal write:
* python3 manage.py loaddata categories
* python3 manage.py loaddata items

* If you do not have a superuser, you can create one now:
write:
* python3 manage.py createsuperuser

In terminal write:
* pip3 install gunicorn
* pip3 freeze > requirements.txt
Now you must make a Procfile in your root directory.
Inside the Procfile, write:
* web: gunicorn(projectname).wsgi:application
In Heroku, remember to add all configs! Like:
* PORT as key and value 8000 in config vars
* django secret password in config vars
* cloudinary url in config vars.

In your settings.py You must add your allowed_hosts.
write: ALLOWED_HOSTS=['yourappname.herokuapp.com','localhost']

Now commit and push
And after you write 
git push heroku main.


## Credits 
I would like to give my deepest thanks to different tutors from code institute.
I would like to thank the slack community.


## Content

* I got inspired from the boutique ado project, code institute. I have borrowed the code for setting up the stripe, webhook_handler, webhooks.

class StripeWH_Handler:
    """Handle Stripe webhooks"""

    def __init__(self, request):
        self.request = request

    def _send_confirmation_email(self, order):
        """Send the user a confirmation email"""
        cust_email = order.email
        subject = render_to_string(
            'checkout/confirmation_emails/confirmation_email_subject.txt',
            {'order': order})
        body = render_to_string(
            'checkout/confirmation_emails/confirmation_email_body.txt',
            {'order': order, 'contact_email': settings.DEFAULT_FROM_EMAIL})
        
        send_mail(
            subject,
            body,
            settings.DEFAULT_FROM_EMAIL,
            [cust_email]
        )        

    def handle_event(self, event):
        """
        Handle a generic/unknown/unexpected webhook event
        """
        return HttpResponse(
            content=f'Unhandled webhook received: {event["type"]}',
            status=200)

    def handle_payment_intent_succeeded(self, event):
        """
        Handle the payment_intent.succeeded webhook from Stripe
        """
        intent = event.data.object
        pid = intent.id
        bag = intent.metadata.bag
        save_info = intent.metadata.save_info

        billing_details = intent.charges.data[0].billing_details
        shipping_details = intent.shipping
        grand_total = round(intent.charges.data[0].amount / 100, 2)

        # Clean data in the shipping details
        for field, value in shipping_details.address.items():
            if value == "":
                shipping_details.address[field] = None

        # Update profile information if save_info was checked
        profile = None
        username = intent.metadata.username
        if username != 'AnonymousUser':
            profile = UserProfile.objects.get(user__username=username)
            if save_info:
                profile.default_phone_number = shipping_details.phone
                profile.default_country = shipping_details.address.country
                profile.default_postcode = shipping_details.address.postal_code
                profile.default_town_or_city = shipping_details.address.city
                profile.default_street_address1 = shipping_details.address.line1
                profile.default_street_address2 = shipping_details.address.line2
                profile.default_county = shipping_details.address.state
                profile.save()

        order_exists = False
        attempt = 1
        while attempt <= 5:
            try:
                order = Order.objects.get(
                    full_name__iexact=shipping_details.name,
                    email__iexact=billing_details.email,
                    phone_number__iexact=shipping_details.phone,
                    country__iexact=shipping_details.address.country,
                    postcode__iexact=shipping_details.address.postal_code,
                    town_or_city__iexact=shipping_details.address.city,
                    street_address1__iexact=shipping_details.address.line1,
                    street_address2__iexact=shipping_details.address.line2,
                    county__iexact=shipping_details.address.state,
                    grand_total=grand_total,
                    original_bag=bag,
                    stripe_pid=pid,
                )
                order_exists = True
                break
            except Order.DoesNotExist:
                attempt += 1
                time.sleep(1)
        if order_exists:
            self._send_confirmation_email(order)
            return HttpResponse(
                content=f'Webhook received: {event["type"]} | SUCCESS: Verified order already in database',
                status=200)
        else:
            order = None
            try:
                order = Order.objects.create(
                    full_name=shipping_details.name,
                    user_profile=profile,
                    email=billing_details.email,
                    phone_number=shipping_details.phone,
                    country=shipping_details.address.country,
                    postcode=shipping_details.address.postal_code,
                    town_or_city=shipping_details.address.city,
                    street_address1=shipping_details.address.line1,
                    street_address2=shipping_details.address.line2,
                    county=shipping_details.address.state,
                    original_bag=bag,
                    stripe_pid=pid,
                )
                for item_id, item_data in json.loads(bag).items():
                    product = Product.objects.get(id=item_id)
                    if isinstance(item_data, int):
                        order_line_item = OrderLineItem(
                            order=order,
                            product=product,
                            quantity=item_data,
                        )
                        order_line_item.save()
                    else:
                        for size, quantity in item_data['items_by_size'].items():
                            order_line_item = OrderLineItem(
                                order=order,
                                product=product,
                                quantity=quantity,
                                product_size=size,
                            )
                            order_line_item.save()
            except Exception as e:
                if order:
                    order.delete()
                return HttpResponse(
                    content=f'Webhook received: {event["type"]} | ERROR: {e}',
                    status=500)
        self._send_confirmation_email(order)
        return HttpResponse(
            content=f'Webhook received: {event["type"]} | SUCCESS: Created order in webhook',
            status=200)

    def handle_payment_intent_payment_failed(self, event):
        """
        Handle the payment_intent.payment_failed webhook from Stripe
        """
        return HttpResponse(
            content=f'Webhook received: {event["type"]}',
            status=200)



@require_POST
@csrf_exempt
def webhook(request):
    """ Listen for webhooks from stripe
        I borrowed this code from code institute, from the project
        boutique Ado
    """
    # Setup
    wh_secret = settings.STRIPE_WH_SECRET
    stripe.api_key = settings.STRIPE_SECRET_KEY

    # Retrieve the webhook data and verify its signature

    payload = request.body
    sig_header = request.META['HTTP_STRIPE_SIGNATURE']
    event = None

    try:
        event = stripe.Webhook.construct_event(
            payload, sig_header, wh_secret
        )
    except ValueError as e:
        #Invalid payload
        return HttpResponse(status=400)
    except stripe.error.SignatureVerificationError as e:
        #Invalid signature
        return HttpResponse(status=400)
    except Exception as e:
        return HttpResponse(content=e, status=400)

    # Set up a webhook handler
    handler = StripeWH_Handler(request)

    # Map webhook events to relevant handler functions
    event_map = {
        'payment_intent.succeeded': handler.handle_payment_intent_succeeded,
        'payment_intent.payment_failed':
            handler.handle_payment_intent_payment_failed,
    }

    # Get the webhook type from Stripe
    event_type = event['type']

    # If there`s a handler for it, get it from the event map
    # Use the generic one by default
    event_handler = event_map.get(event_type, handler.handle_event)

    # Call the event handler with the event
    response = event_handler(event)
    return response

-------------------------------------------

/*
    Core logic/payment flow for this comes from here:
    https://stripe.com/docs/payments/accept-a-payment
    CSS from here: 
    https://stripe.com/docs/stripe-js
*/

/* Borrowed this code from code institute, from the
   Boutique Ado project, by using my own variables names */

let stripePublicKey = $('#id_stripe_public_key').text().slice(1, -1);
let clientSecret = $('#id_client_secret').text().slice(1, -1);
let stripe = Stripe(stripePublicKey);
let elements = stripe.elements();
let style = {
    base: {
        color: '#000',
        fontFamily: '"Helvetica Neue", Helvetica, sans-serif',
        fontSmoothing: 'antialiased',
        fontSize: '16px',
        '::placeholder': {
            color: '#aab7c4'
        }
    },
    invalid: {
        color: '#dc3545',
        iconColor: '#dc3545'
    }
};
let card = elements.create('card', {
    style: style
});
card.mount('#card-element');


/* Borrowed this code from code institute, from the
   Boutique Ado project */

// Handle realtime validation errors on the card element
card.addEventListener('change', function (event) {
    let errorDiv = document.getElementById('card-errors');
    if (event.error) {
        let html = `
            <span class="icon" role="alert">
                <i class="fas fa-times"></i>
            </span>
            <span>${event.error.message}</span>
        `;
        $(errorDiv).html(html);
    } else {
        errorDiv.textContent = '';
    }
});
-----------------------------------
/* Borrowed this code from code institute, from the
   Boutique Ado project */

// Handle form submit
let form = document.getElementById('payment-form');

form.addEventListener('submit', function (ev) {
    ev.preventDefault();
    card.update({
        'disabled': true
    });
    $('#submit-button').attr('disabled', true);
    $('#payment-form').fadeToggle(100);
    $('#loading-overlay').fadeToggle(100);

    let saveInfo = Boolean($('#id-save-info').attr('checked'));
    // From using {% csrf_token %} in the form
    let csrfToken = $('input[name="csrfmiddlewaretoken"]').val();
    let postData = {
        'csrfmiddlewaretoken': csrfToken,
        'client_secret': clientSecret,
        'save_info': saveInfo,
    };
    let url = '/checkout/cache_checkout_data/';
    $.post(url, postData).done(function () {
        stripe.confirmCardPayment(clientSecret, {
            payment_method: {
                card: card,
                billing_details: {
                    name: $.trim(form.full_name.value),
                    email: $.trim(form.email.value),
                    phone: $.trim(form.mobile_number.value),
                    address: {
                        line1: $.trim(form.street_address.value),
                        city: $.trim(form.city.value),
                        country: $.trim(form.country.value),
                    }
                }
            },
            shipping: {
                name: $.trim(form.full_name.value),
                phone: $.trim(form.mobile_number.value),
                address: {
                    line1: $.trim(form.street_address.value),
                    postal_code: $.trim(form.zip_code.value),
                    city: $.trim(form.city.value),
                    country: $.trim(form.country.value),
                }

            },

        }).then(function(result) {
            if (result.error) {
                let errorDiv = document.getElementById('card-errors');
                let html = `
                    <span class="icon" role="alert">
                    <i class="fas fa-times"></i>
                    </span>
                    <span>${result.error.message}</span>`;
                $(errorDiv).html(html);
                $('#payment-form').fadeToggle(100);
                $('#loading-overlay').fadeToggle(100);

                card.update({
                    'disabled': false
                });
                $('#submit-button').attr('disabled', false);
            } else {
                if (result.paymentIntent.status === 'succeeded') {
                    form.submit();
                }
            }
        });

    }).fail(function (){
        //just reload the page, the error will be in django messages
      location.reload();
    })
});
-----------------------------
* I also got inspired from the CL love running project to start with this default code to make it easier to use css. Here is the original code from the CL love running project:

*{ margin:0;
padding: 0;
border: none; }


    

* I used icons from font awesome

* I used coolors.co to find a nice colour palette to my webpage.

* I used youtube as a social media link.
* I used instagram as a social media link.
* I imported a font from google font.
### Media
* I own all the images on the website without the background image, that I got from unsplash website, a free to use image.

